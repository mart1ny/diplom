# Прогресс разработки

В этом файле фиксируются ключевые изменения в проекте по мере движения к MVP.

## 2025-12-01

### Улучшение трекинга
- Переписан `SimpleKalmanTracker`: теперь хранит состояние треков, выполняет жадную ассоциацию "детекция ↔ предсказание" по матрице расстояний, очищает «мертвые» треки и стабильно выдаёт позиции.

### Подсчёт очередей и ROI
- Добавлен `QueueCounter`: считывает нахождение треков в полигонах подходов, поддерживает кастомный JSON-конфиг и выводит текущие длины очередей.
- В `inference.py` подключён подсчёт очередей, добавлена CLI-опция `--roi-config`. Лог теперь выводит состояние очередей.

### LP-оптимизация фаз
- Реализован модуль `PhaseOptimizer` на cvxpy: распределяет доли зелёного и длину цикла, минимизируя остаток очередей и штраф за риск.
- Интеграция в `inference.py`: агрегация риска по подходам, вызов оптимизатора раз в секунду, логирование плана (greens + cycle).
- `requirements.txt` дополнен зависимостью `cvxpy`.

### Подготовка к LSTM-прогнозу
- Описан план внедрения LSTM (`lstm/README.md`) и создан образцовый лог очередей `lstm/queues_sample.jsonl` (включая идентификатор светофора и все направления).
- Реализованы `lstm/demand_forecaster.py` (Dataset + LSTM) и `lstm/train_demand_forecaster.py` — полный пайплайн обучения модели прогноза очередей по JSONL-логу.


