# План внедрения LSTM-прогнозирования

## 1. Сбор и подготовка данных
- Логировать агрегаты каждые N секунд/минут: `{timestamp, light_id, approach, queue_len, risk_score}`.
- Добавлять календарные признаки: `weekday`, `hour`, `is_weekend`, `is_holiday`, при наличии — `weather_code`.
- Сохранять в `queues.jsonl` или БД (TimescaleDB/SQLite). Хранить минимум несколько дней.

## 2. Архитектура модели
- Модуль `demand_forecaster.py`: LSTM/GRU с входом `[queue_len, risk_score, weekday, hour, weather...]`.
- Горизонт прогноза, например 5 минут (5 шагов по 1 мин).
- Веса сохранять в `models/lstm_forecaster.pt`, поддерживать дообучение.

## 3. Тренинг и валидация
- Разделение train/val, стандартизация численных признаков.
- Supervised обучение: вход — последние `T` отсчётов, выход — вектор будущих очередей.
- Метрики: MAE/MAPE по подходам, логирование в TensorBoard.

## 4. Интеграция с пайплайном
- В `inference.py` добавить `--demand-model-path`.
- После обновления очередей вызывать прогностическую модель; комбинировать с текущими данными (`q_effective = alpha*current + (1-alpha)*forecast`).
- Логировать прогнозы рядом с измерениями.

## 5. Эксплуатация
- Переобучение по расписанию и мониторинг деградации.
- Версионировать логи и модели, фиксировать изменения в `progress.md`.
- Настроить алерты при росте MAE или проблемах со входными данными.

