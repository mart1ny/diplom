# Фронтенд и API

## 1. Backend API (FastAPI + пайплайн)

1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Запустите сервер (по умолчанию `http://localhost:8000`):
   ```bash
   uvicorn scripts.api_server:app --reload --host 0.0.0.0 --port 8000
   ```
3. Эндпоинты:
   - `POST /api/process-video` — загрузка видео. Возвращает историю очередей, планы фаз, ссылки на jsonl/видео.
   - `GET /api/health` — проверка статуса.
   - Статические файлы доступны по `/results/<file>` и `/uploads/<file>`.

API сохраняет загруженные ролики в `uploads/`, а результаты — в `results/` (оба каталога игнорируются в Git).

## 2. Фронтенд (Vite + React)

1. Установите зависимости:
   ```bash
   cd frontend
   npm install
   ```
2. Во время разработки запустите Vite:
   ```bash
   npm run dev
   ```
   При необходимости задайте адрес API (если не `localhost:8000`):
   ```bash
   echo "VITE_API_BASE=http://<backend-host>:8000" > .env.local
   ```
3. Продакшен-сборка:
   ```bash
   npm run build
   npm run preview  # проверить сборку
   ```

## 3. Как пользоваться

1. На фронте выберите видео и нажмите «Загрузить и обработать».
2. Backend запускает пайплайн (`YOLO → трекер → near-miss → оптимизация фаз`), результат возвращается в JSON.
3. В дашборде показываются:
   - количество near-miss событий;
   - максимальные очереди по подходам;
   - длина последнего цикла и доли зелёного;
   - ссылки на аннотированное видео и events.jsonl;
   - последние измерения очередей и оптимизаций.

Таким образом фронт, API и пайплайн полностью связаны: загрузка файла сразу инициирует обработку и выдачу рекомендаций.


